<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>KaiChatHub</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    :root {
      --bg-primary: #0f0f14;
      --bg-secondary: #16161d;
      --bg-tertiary: #1e1e28;
      --accent-yuanbao: #00d4aa;
      --accent-yiyan: #4f8cff;
      --accent-kimi: #027AFF;
      --accent-doubao: #4facfe;
      --accent-deepseek: #4d6bfe;
      --accent-qwen: #6F69F7;
      --accent-chatgpt: #10a37f;
      --accent-claude: #d97757;
      --accent-gemini: #4d8cf6;
      --accent-settings: #ff9f43;
      --text-primary: #f0f0f5;
      --text-secondary: #8a8a9a;
      --border-color: #2a2a38;
      --sidebar-width: 72px;
      --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: transparent;
      color: var(--text-primary);
      overflow: hidden;
      height: 100vh;
    }

    .sidebar {
      width: var(--sidebar-width);
      height: 100vh;
      background: var(--bg-secondary);
      border-right: 1px solid var(--border-color);
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 60px 0 20px;
      -webkit-app-region: drag;
      position: fixed;
      left: 0;
      top: 0;
    }

    .nav-items {
      display: flex;
      flex-direction: column;
      gap: 8px;
      -webkit-app-region: no-drag;
    }

    .nav-item {
      width: 48px;
      height: 48px;
      border-radius: 14px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: var(--transition);
      position: relative;
      background: transparent;
      border: none;
      outline: none;
    }

    .nav-item::before {
      content: '';
      position: absolute;
      left: -12px;
      width: 4px;
      height: 0;
      background: currentColor;
      border-radius: 0 2px 2px 0;
      transition: var(--transition);
    }

    .nav-item:hover {
      background: var(--bg-tertiary);
      transform: scale(1.05);
    }

    .nav-item.active::before {
      height: 24px;
    }

    .nav-item.active {
      background: var(--bg-tertiary);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
    }

    .nav-item svg,
    .nav-item .nav-icon {
      width: 26px;
      height: 26px;
      object-fit: contain;
    }

    /* 针对 Gemini 星形图标进行视觉尺寸补偿 */
    .nav-item[data-tab="gemini"] svg {
      width: 32px;
      height: 32px;
    }

    .nav-item[data-tab="yuanbao"]::before { background: var(--accent-yuanbao); }
    .nav-item[data-tab="yiyan"]::before { background: var(--accent-yiyan); }
    .nav-item[data-tab="kimi"]::before { background: var(--accent-kimi); }
    .nav-item[data-tab="doubao"]::before { background: var(--accent-doubao); }
    .nav-item[data-tab="deepseek"]::before { background: var(--accent-deepseek); }
    .nav-item[data-tab="qwen"]::before { background: var(--accent-qwen); }
    .nav-item[data-tab="chatgpt"]::before { background: var(--accent-chatgpt); }
    .nav-item[data-tab="claude"]::before { background: var(--accent-claude); }
    .nav-item[data-tab="gemini"]::before { background: var(--accent-gemini); }

    .nav-item[data-tab="yuanbao"]:hover,
    .nav-item[data-tab="yuanbao"].active { background: rgba(0, 212, 170, 0.15); }
    .nav-item[data-tab="yiyan"]:hover,
    .nav-item[data-tab="yiyan"].active { background: rgba(79, 140, 255, 0.15); }
    .nav-item[data-tab="kimi"]:hover,
    .nav-item[data-tab="kimi"].active { background: rgba(2, 122, 255, 0.15); }
    .nav-item[data-tab="doubao"]:hover,
    .nav-item[data-tab="doubao"].active { background: rgba(79, 172, 254, 0.15); }
    .nav-item[data-tab="deepseek"]:hover,
    .nav-item[data-tab="deepseek"].active { background: rgba(77, 107, 254, 0.15); }
    .nav-item[data-tab="qwen"]:hover,
    .nav-item[data-tab="qwen"].active { background: rgba(111, 105, 247, 0.15); }
    .nav-item[data-tab="chatgpt"]:hover,
    .nav-item[data-tab="chatgpt"].active { background: rgba(16, 163, 127, 0.15); }
    .nav-item[data-tab="claude"]:hover,
    .nav-item[data-tab="claude"].active { background: rgba(217, 119, 87, 0.15); }
    .nav-item[data-tab="gemini"]:hover,
    .nav-item[data-tab="gemini"].active { background: rgba(77, 140, 246, 0.15); }


    .sidebar-footer {
      margin-top: auto;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 12px;
      -webkit-app-region: no-drag;
    }

    .settings-btn {
      width: 42px;
      height: 42px;
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: var(--transition);
      background: transparent;
      border: none;
      outline: none;
      color: var(--text-secondary);
      position: relative;
    }

    .settings-btn:hover {
      background: var(--bg-tertiary);
      color: var(--accent-settings);
      transform: rotate(30deg);
    }

    .settings-btn svg {
      width: 22px;
      height: 22px;
    }

    .proxy-indicator {
      position: absolute;
      bottom: 4px;
      right: 4px;
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: var(--text-secondary);
    }

    .proxy-indicator.active {
      background: var(--accent-yuanbao);
      box-shadow: 0 0 8px var(--accent-yuanbao);
    }

    .brand-icon {
      width: 36px;
      height: 36px;
      background: linear-gradient(135deg, var(--accent-yuanbao), var(--accent-deepseek));
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
      font-weight: 700;
    }

    /* 加载提示 - 居中在内容区域（sidebar 右侧） */
    .loading-indicator {
      position: fixed;
      top: 50%;
      left: calc(50% + 36px);
      transform: translate(-50%, -50%);
      background: var(--bg-secondary);
      border: 1px solid var(--border-color);
      border-radius: 16px;
      padding: 24px 32px;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 16px;
      z-index: 500;
      opacity: 0;
      visibility: hidden;
      transition: var(--transition);
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.4);
    }

    .loading-indicator.show {
      opacity: 1;
      visibility: visible;
    }

    .loading-spinner {
      width: 40px;
      height: 40px;
      border: 3px solid var(--border-color);
      border-top-color: var(--accent-yuanbao);
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    .loading-text {
      font-size: 14px;
      color: var(--text-secondary);
    }

    /* 设置面板 */
    .settings-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(15, 15, 20, 0.85);
      backdrop-filter: blur(8px);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      opacity: 0;
      visibility: hidden;
      transition: var(--transition);
    }

    .settings-overlay.active {
      opacity: 1;
      visibility: visible;
    }

    .settings-panel {
      background: var(--bg-secondary);
      border: 1px solid var(--border-color);
      border-radius: 20px;
      width: 480px;
      max-width: 90vw;
      max-height: 85vh;
      display: flex;
      flex-direction: column;
      transform: scale(0.9) translateY(20px);
      transition: var(--transition);
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
    }

    .settings-overlay.active .settings-panel {
      transform: scale(1) translateY(0);
    }

    .settings-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 20px 24px;
      border-bottom: 1px solid var(--border-color);
    }

    .settings-title {
      font-size: 18px;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .settings-title svg {
      width: 22px;
      height: 22px;
      color: var(--accent-settings);
    }

    .close-btn {
      width: 32px;
      height: 32px;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      background: transparent;
      border: none;
      color: var(--text-secondary);
    }

    .close-btn:hover {
      background: var(--bg-tertiary);
      color: var(--text-primary);
    }

    .settings-body {
      padding: 24px;
      overflow-y: auto;
      flex: 1;
    }

    .section-title {
      font-size: 14px;
      font-weight: 600;
      color: var(--text-secondary);
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 16px;
    }

    .form-group {
      margin-bottom: 16px;
    }

    .form-label {
      display: block;
      font-size: 14px;
      font-weight: 500;
      margin-bottom: 8px;
    }

    .form-input {
      width: 100%;
      padding: 12px 16px;
      background: var(--bg-tertiary);
      border: 1px solid var(--border-color);
      border-radius: 10px;
      color: var(--text-primary);
      font-size: 14px;
    }

    .form-input:focus {
      outline: none;
      border-color: var(--accent-settings);
    }

    .form-hint {
      font-size: 12px;
      color: var(--text-secondary);
      margin-top: 6px;
      line-height: 1.6;
    }

    .form-hint code {
      background: var(--bg-primary);
      padding: 2px 6px;
      border-radius: 4px;
      font-family: monospace;
      font-size: 11px;
    }

    .toggle-group {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 12px 16px;
      background: var(--bg-tertiary);
      border-radius: 10px;
      margin-bottom: 16px;
    }

    .toggle-switch {
      width: 48px;
      height: 26px;
      background: var(--border-color);
      border-radius: 13px;
      cursor: pointer;
      position: relative;
    }

    .toggle-switch.active {
      background: var(--accent-settings);
    }

    .toggle-switch::after {
      content: '';
      position: absolute;
      top: 3px;
      left: 3px;
      width: 20px;
      height: 20px;
      background: white;
      border-radius: 50%;
      transition: var(--transition);
    }

    .toggle-switch.active::after {
      transform: translateX(22px);
    }

    .btn-group {
      display: flex;
      gap: 12px;
      margin-top: 24px;
    }

    .btn {
      flex: 1;
      padding: 12px 20px;
      border-radius: 10px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }

    .btn-primary {
      background: var(--accent-settings);
      border: none;
      color: #000;
    }

    .btn-secondary {
      background: transparent;
      border: 1px solid var(--border-color);
      color: var(--text-primary);
    }

    .test-result {
      padding: 12px 16px;
      border-radius: 10px;
      font-size: 13px;
      margin-top: 12px;
      display: none;
    }

    .test-result.show { display: flex; align-items: center; gap: 8px; }
    .test-result.success { background: rgba(0, 212, 170, 0.15); color: var(--accent-yuanbao); }
    .test-result.error { background: rgba(255, 99, 99, 0.15); color: #ff6363; }

    /* 页面管理 */
    .tab-toggle-list {
      background: var(--bg-tertiary);
      border-radius: 10px;
      overflow: hidden;
      margin-bottom: 24px;
    }

    .tab-toggle-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 10px 16px;
      transition: background 0.15s;
    }

    .tab-toggle-item:hover {
      background: rgba(255, 255, 255, 0.03);
    }

    .tab-toggle-item + .tab-toggle-item {
      border-top: 1px solid var(--border-color);
    }

    .tab-toggle-name {
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 14px;
    }

    .tab-toggle-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      flex-shrink: 0;
    }

    .toggle-switch-sm {
      width: 40px;
      height: 22px;
      background: var(--border-color);
      border-radius: 11px;
      cursor: pointer;
      position: relative;
      flex-shrink: 0;
      transition: var(--transition);
    }

    .toggle-switch-sm.active {
      background: var(--accent-settings);
    }

    .toggle-switch-sm.disabled {
      opacity: 0.4;
      cursor: not-allowed;
    }

    .toggle-switch-sm::after {
      content: '';
      position: absolute;
      top: 2px;
      left: 2px;
      width: 18px;
      height: 18px;
      background: white;
      border-radius: 50%;
      transition: var(--transition);
    }

    .toggle-switch-sm.active::after {
      transform: translateX(18px);
    }

    .section-divider {
      height: 1px;
      background: var(--border-color);
      margin: 8px 0 24px;
    }
  </style>
</head>
<body>
  <aside class="sidebar">
    <nav class="nav-items">
      <!-- 1. 腾讯元宝 -->
      <button class="nav-item active" data-tab="yuanbao" title="腾讯元宝">
        <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
          <path d="M12 24c6.627 0 12-5.373 12-12S18.627 0 12 0 0 5.373 0 12s5.373 12 12 12z" fill="url(#yuanbao-fill-0)"></path>
          <path clip-rule="evenodd" d="M12 0c.518 0 1.028.033 1.528.096A6.188 6.188 0 0112.12 12.28l-.12.001c-2.99 0-5.242 2.179-5.554 5.11-.223 2.086.353 4.412 2.242 6.146C3.672 22.1 0 17.479 0 12 0 5.373 5.373 0 12 0z" fill="url(#yuanbao-fill-1)" fill-rule="evenodd"></path>
          <path clip-rule="evenodd" d="M5.286 5a2.438 2.438 0 01.682 3.38c-3.962 5.966-3.215 10.743 2.648 15.136C3.636 22.056 0 17.452 0 12c0-1.787.39-3.482 1.09-5.006.253-.435.525-.872.817-1.311A2.438 2.438 0 015.286 5z" fill="url(#yuanbao-fill-2)" fill-rule="evenodd"></path>
          <path clip-rule="evenodd" d="M12.98.04c.272.021.543.053.81.093.583.106 1.117.254 1.538.44 6.638 2.927 8.07 10.052 1.748 15.642a4.126 4.126 0 01-5.822-.358c-1.51-1.706-1.3-4.184.357-5.822.858-.848 3.108-1.223 4.045-2.44 1.257-1.635 2.122-6.01-2.523-7.507L12.98.04z" fill="url(#yuanbao-fill-3)" fill-rule="evenodd"></path>
          <path clip-rule="evenodd" d="M13.528.096A6.187 6.187 0 0112 12.281a5.752 5.752 0 00-1.71.255c.147-.905.595-1.784 1.321-2.501.858-.848 3.108-1.223 4.045-2.441 1.27-1.651 2.14-6.104-2.676-7.554.184.014.367.033.548.056z" fill="#ECECEE" fill-rule="evenodd"></path>
          <defs>
            <linearGradient gradientUnits="userSpaceOnUse" id="yuanbao-fill-0" x1="12" x2="12" y1="0" y2="24"><stop stop-color="#02B2FC"></stop><stop offset=".5" stop-color="#20CBB6"></stop><stop offset="1" stop-color="#13D363"></stop></linearGradient>
            <linearGradient gradientUnits="userSpaceOnUse" id="yuanbao-fill-1" x1="9.095" x2="9.095" y1="0" y2="23.537"><stop stop-color="#C3EBEF"></stop><stop offset="1" stop-color="#D3F4DD"></stop></linearGradient>
            <linearGradient gradientUnits="userSpaceOnUse" id="yuanbao-fill-2" x1="4.308" x2="4.308" y1="4.593" y2="23.516"><stop stop-color="#14D368"></stop><stop offset=".5" stop-color="#24CEAD"></stop><stop offset="1" stop-color="#03B4F8"></stop></linearGradient>
            <linearGradient gradientUnits="userSpaceOnUse" id="yuanbao-fill-3" x1="15.685" x2="15.685" y1=".039" y2="17.249"><stop stop-color="#61CFFA" stop-opacity=".996"></stop><stop offset="1" stop-color="#79E3C0"></stop></linearGradient>
          </defs>
        </svg>
      </button>
      <!-- 2. 文心一言 -->
      <button class="nav-item" data-tab="yiyan" title="文心一言">
        <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
          <path d="M11.32 1.176a1.4 1.4 0 011.36 0l8.64 4.843c.421.234.68.67.68 1.141v9.68c0 .472-.259.908-.68 1.143l-8.64 4.84a1.4 1.4 0 01-1.36 0l-8.64-4.84A1.31 1.31 0 012 16.84V7.159c0-.471.259-.907.68-1.142l8.64-4.84zm7.42 13.839V8.227L12.002 12 12 19.551l6.059-3.394a1.31 1.31 0 00.68-1.142zM12.68 4.833a1.393 1.393 0 00-1.36 0L5.944 7.846c-.421.235-.68.67-.68 1.142v6.027c0 .47.259.905.68 1.142l2.795 1.566V11.09a1.546 1.546 0 00.221.79 1.527 1.527 0 01-.216-.834l.004-.094.02-.15.018-.084.017-.062.039-.117.062-.142.035-.065.081-.13.094-.122.084-.091.08-.075.125-.1.071-.048.134-.076 5.87-3.29-2.796-1.566z" fill="url(#wenxin-fill)"></path>
          <path d="M12 11.088c0-.875-.73-1.584-1.631-1.584a1.66 1.66 0 00-.855.237c-.027.016-.055.033-.08.05a2.361 2.361 0 00-.123.093c-.022.02-.045.038-.066.059l-.048.045-.063.067c-.014.016-.028.031-.04.048a2.303 2.303 0 00-.094.125l-.042.069a1.7 1.7 0 00-.07.13l-.036.081a.764.764 0 00-.022.06c-.01.03-.02.058-.028.087l-.017.062a.883.883 0 00-.03.16c-.002.025-.007.05-.008.074a1.527 1.527 0 00.213.929c.302.508.85.792 1.414.792.277 0 .558-.068.814-.212l.815-.457v-.914L12 11.088z" fill="#012F8D"></path>
          <defs>
            <linearGradient id="wenxin-fill" x1="9.155%" x2="90.531%" y1="75.177%" y2="25.028%"><stop offset="0%" stop-color="#0A51C3"></stop><stop offset="100%" stop-color="#23A4FB"></stop></linearGradient>
          </defs>
        </svg>
      </button>
      <!-- 3. 字节豆包 -->
      <button class="nav-item" data-tab="doubao" title="字节豆包">
        <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
          <path d="M5.31 15.756c.172-3.75 1.883-5.999 2.549-6.739-3.26 2.058-5.425 5.658-6.358 8.308v1.12C1.501 21.513 4.226 24 7.59 24a6.59 6.59 0 002.2-.375c.353-.12.7-.248 1.039-.378.913-.899 1.65-1.91 2.243-2.992-4.877 2.431-7.974.072-7.763-4.5l.002.001z" fill="#1E37FC"></path>
          <path d="M22.57 10.283c-1.212-.901-4.109-2.404-7.397-2.8.295 3.792.093 8.766-2.1 12.773a12.782 12.782 0 01-2.244 2.992c3.764-1.448 6.746-3.457 8.596-5.219 2.82-2.683 3.353-5.178 3.361-6.66a2.737 2.737 0 00-.216-1.084v-.002z" fill="#37E1BE"></path>
          <path d="M14.303 1.867C12.955.7 11.248 0 9.39 0 7.532 0 5.883.677 4.545 1.807 2.791 3.29 1.627 5.557 1.5 8.125v9.201c.932-2.65 3.097-6.25 6.357-8.307.5-.318 1.025-.595 1.569-.829 1.883-.801 3.878-.932 5.746-.706-.222-2.83-.718-5.002-.87-5.617h.001z" fill="#A569FF"></path>
          <path d="M17.305 4.961a199.47 199.47 0 01-1.08-1.094c-.202-.213-.398-.419-.586-.622l-1.333-1.378c.151.615.648 2.786.869 5.617 3.288.395 6.185 1.898 7.396 2.8-1.306-1.275-3.475-3.487-5.266-5.323z" fill="#1E37FC"></path>
        </svg>
      </button>
      <!-- 4. 深度求索 DeepSeek -->
      <button class="nav-item" data-tab="deepseek" title="深度求索 DeepSeek">
        <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
          <path d="M23.748 4.482c-.254-.124-.364.113-.512.234-.051.039-.094.09-.137.136-.372.397-.806.657-1.373.626-.829-.046-1.537.214-2.163.848-.133-.782-.575-1.248-1.247-1.548-.352-.156-.708-.311-.955-.65-.172-.241-.219-.51-.305-.774-.055-.16-.11-.323-.293-.35-.2-.031-.278.136-.356.276-.313.572-.434 1.202-.422 1.84.027 1.436.633 2.58 1.838 3.393.137.093.172.187.129.323-.082.28-.18.552-.266.833-.055.179-.137.217-.329.14a5.526 5.526 0 01-1.736-1.18c-.857-.828-1.631-1.742-2.597-2.458a11.365 11.365 0 00-.689-.471c-.985-.957.13-1.743.388-1.836.27-.098.093-.432-.779-.428-.872.004-1.67.295-2.687.684a3.055 3.055 0 01-.465.137 9.597 9.597 0 00-2.883-.102c-1.885.21-3.39 1.102-4.497 2.623C.082 8.606-.231 10.684.152 12.85c.403 2.284 1.569 4.175 3.36 5.653 1.858 1.533 3.997 2.284 6.438 2.14 1.482-.085 3.133-.284 4.994-1.86.47.234.962.327 1.78.397.63.059 1.236-.03 1.705-.128.735-.156.684-.837.419-.961-2.155-1.004-1.682-.595-2.113-.926 1.096-1.296 2.746-2.642 3.392-7.003.05-.347.007-.565 0-.845-.004-.17.035-.237.23-.256a4.173 4.173 0 001.545-.475c1.396-.763 1.96-2.015 2.093-3.517.02-.23-.004-.467-.247-.588zM11.581 18c-2.089-1.642-3.102-2.183-3.52-2.16-.392.024-.321.471-.235.763.09.288.207.486.371.739.114.167.192.416-.113.603-.673.416-1.842-.14-1.897-.167-1.361-.802-2.5-1.86-3.301-3.307-.774-1.393-1.224-2.887-1.298-4.482-.02-.386.093-.522.477-.592a4.696 4.696 0 011.529-.039c2.132.312 3.946 1.265 5.468 2.774.868.86 1.525 1.887 2.202 2.891.72 1.066 1.494 2.082 2.48 2.914.348.292.625.514.891.677-.802.09-2.14.11-3.054-.614zm1-6.44a.306.306 0 01.415-.287.302.302 0 01.2.288.306.306 0 01-.31.307.303.303 0 01-.304-.308zm3.11 1.596c-.2.081-.399.151-.59.16a1.245 1.245 0 01-.798-.254c-.274-.23-.47-.358-.552-.758a1.73 1.73 0 01.016-.588c.07-.327-.008-.537-.239-.727-.187-.156-.426-.199-.688-.199a.559.559 0 01-.254-.078c-.11-.054-.2-.19-.114-.358.028-.054.16-.186.192-.21.356-.202.767-.136 1.146.016.352.144.618.408 1.001.782.391.451.462.576.685.914.176.265.336.537.445.848.067.195-.019.354-.25.452z" fill="#4D6BFE"></path>
        </svg>
      </button>
      <!-- 5. Kimi -->
      <button class="nav-item" data-tab="kimi" title="Kimi">
        <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" fill-rule="evenodd">
          <path d="M19.738 5.776c.163-.209.306-.4.457-.585.07-.087.064-.153-.004-.244-.655-.861-.717-1.817-.34-2.787.283-.73.909-1.072 1.674-1.145.477-.045.945.004 1.379.236.57.305.902.77 1.01 1.412.086.512.07 1.012-.075 1.508-.257.878-.888 1.333-1.753 1.448-.718.096-1.446.108-2.17.157-.056.004-.113 0-.178 0z" fill="#027AFF"></path>
          <path d="M17.962 1.844h-4.326l-3.425 7.81H5.369V1.878H1.5V22h3.87v-8.477h6.824a3.025 3.025 0 002.743-1.75V22h3.87v-8.477a3.87 3.87 0 00-3.588-3.86v-.01h-2.125a3.94 3.94 0 002.323-2.12l2.545-5.689z" fill="#ffffff"></path>
        </svg>
      </button>
      <!-- 6. 通义千问 -->
      <button class="nav-item" data-tab="qwen" title="通义千问">
        <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
          <path d="M12.604 1.34c.393.69.784 1.382 1.174 2.075a.18.18 0 00.157.091h5.552c.174 0 .322.11.446.327l1.454 2.57c.19.337.24.478.024.837-.26.43-.513.864-.76 1.3l-.367.658c-.106.196-.223.28-.04.512l2.652 4.637c.172.301.111.494-.043.77-.437.785-.882 1.564-1.335 2.34-.159.272-.352.375-.68.37-.777-.016-1.552-.01-2.327.016a.099.099 0 00-.081.05 575.097 575.097 0 01-2.705 4.74c-.169.293-.38.363-.725.364-.997.003-2.002.004-3.017.002a.537.537 0 01-.465-.271l-1.335-2.323a.09.09 0 00-.083-.049H4.982c-.285.03-.553-.001-.805-.092l-1.603-2.77a.543.543 0 01-.002-.54l1.207-2.12a.198.198 0 000-.197 550.951 550.951 0 01-1.875-3.272l-.79-1.395c-.16-.31-.173-.496.095-.965.465-.813.927-1.625 1.387-2.436.132-.234.304-.334.584-.335a338.3 338.3 0 012.589-.001.124.124 0 00.107-.063l2.806-4.895a.488.488 0 01.422-.246c.524-.001 1.053 0 1.583-.006L11.704 1c.341-.003.724.032.9.34zm-3.432.403a.06.06 0 00-.052.03L6.254 6.788a.157.157 0 01-.135.078H3.253c-.056 0-.07.025-.041.074l5.81 10.156c.025.042.013.062-.034.063l-2.795.015a.218.218 0 00-.2.116l-1.32 2.31c-.044.078-.021.118.068.118l5.716.008c.046 0 .08.02.104.061l1.403 2.454c.046.081.092.082.139 0l5.006-8.76.783-1.382a.055.055 0 01.096 0l1.424 2.53a.122.122 0 00.107.062l2.763-.02a.04.04 0 00.035-.02.041.041 0 000-.04l-2.9-5.086a.108.108 0 010-.113l.293-.507 1.12-1.977c.024-.041.012-.062-.035-.062H9.2c-.059 0-.073-.026-.043-.077l1.434-2.505a.107.107 0 000-.114L9.225 1.774a.06.06 0 00-.053-.031zm6.29 8.02c.046 0 .058.02.034.06l-.832 1.465-2.613 4.585a.056.056 0 01-.05.029.058.058 0 01-.05-.029L8.498 9.841c-.02-.034-.01-.052.028-.054l.216-.012 6.722-.012z" fill="url(#qwen-fill)" fill-rule="nonzero"></path>
          <defs>
            <linearGradient id="qwen-fill" x1="0%" x2="100%" y1="0%" y2="0%"><stop offset="0%" stop-color="#6336E7" stop-opacity=".84"></stop><stop offset="100%" stop-color="#6F69F7" stop-opacity=".84"></stop></linearGradient>
          </defs>
        </svg>
      </button>
      <!-- 7. ChatGPT -->
      <button class="nav-item" data-tab="chatgpt" title="ChatGPT">
        <svg viewBox="0 0 24 24" fill="#10a37f">
          <path d="M22.28 9.82a5.98 5.98 0 00-.52-4.91 6.05 6.05 0 00-6.51-2.9A6.07 6.07 0 004.98 4.18a5.98 5.98 0 00-4 2.9 6.05 6.05 0 00.74 7.1 5.98 5.98 0 00.51 4.91 6.05 6.05 0 006.51 2.9A6.07 6.07 0 0019.02 19.82a5.98 5.98 0 004-2.9 6.05 6.05 0 00-.74-7.1zm-9.02 12.61a4.48 4.48 0 01-2.88-1.04l.14-.08 4.78-2.76a.8.8 0 00.39-.68v-6.74l2.02 1.17a.07.07 0 01.04.05v5.58a4.5 4.5 0 01-4.5 4.5zm-9.66-4.13a4.47 4.47 0 01-.53-3.01l.14.08 4.78 2.76a.78.78 0 00.78 0l5.84-3.37v2.33a.08.08 0 01-.03.06l-4.83 2.79a4.5 4.5 0 01-6.15-1.64zM2.34 7.9a4.49 4.49 0 012.37-1.97v5.68a.77.77 0 00.39.68l5.81 3.35-2.02 1.17a.08.08 0 01-.07 0L4 14.02a4.5 4.5 0 01-1.66-6.13zm16.6 3.86l-5.84-3.37 2.02-1.17a.08.08 0 01.07 0l4.83 2.79a4.49 4.49 0 01-.68 8.1v-5.67a.79.79 0 00-.4-.68zm2.01-3.02l-.14-.09-4.77-2.78a.78.78 0 00-.79 0L9.41 9.23V6.9a.07.07 0 01.03-.06l4.83-2.79a4.5 4.5 0 016.68 4.66zM8.31 12.86l-2.02-1.16a.08.08 0 01-.04-.06V6.07a4.5 4.5 0 017.38-3.45l-.14.08-4.78 2.76a.8.8 0 00-.39.68zm1.1-2.37l2.6-1.5 2.6 1.5v3l-2.6 1.5-2.6-1.5z"/>
        </svg>
      </button>
      <!-- 8. Gemini -->
      <button class="nav-item" data-tab="gemini" title="Gemini">
        <svg height="1em" style="flex:none;line-height:1" viewBox="0 0 24 24" width="1em" xmlns="http://www.w3.org/2000/svg">
          <path d="M20.616 10.835a14.147 14.147 0 01-4.45-3.001 14.111 14.111 0 01-3.678-6.452.503.503 0 00-.975 0 14.134 14.134 0 01-3.679 6.452 14.155 14.155 0 01-4.45 3.001c-.65.28-1.318.505-2.002.678a.502.502 0 000 .975c.684.172 1.35.397 2.002.677a14.147 14.147 0 014.45 3.001 14.112 14.112 0 013.679 6.453.502.502 0 00.975 0c.172-.685.397-1.351.677-2.003a14.145 14.145 0 013.001-4.45 14.113 14.113 0 016.453-3.678.503.503 0 000-.975 13.245 13.245 0 01-2.003-.678z" fill="#3186FF"></path>
          <path d="M20.616 10.835a14.147 14.147 0 01-4.45-3.001 14.111 14.111 0 01-3.678-6.452.503.503 0 00-.975 0 14.134 14.134 0 01-3.679 6.452 14.155 14.155 0 01-4.45 3.001c-.65.28-1.318.505-2.002.678a.502.502 0 000 .975c.684.172 1.35.397 2.002.677a14.147 14.147 0 014.45 3.001 14.112 14.112 0 013.679 6.453.502.502 0 00.975 0c.172-.685.397-1.351.677-2.003a14.145 14.145 0 013.001-4.45 14.113 14.113 0 016.453-3.678.503.503 0 000-.975 13.245 13.245 0 01-2.003-.678z" fill="url(#lobe-icons-gemini-fill-0)"></path>
          <path d="M20.616 10.835a14.147 14.147 0 01-4.45-3.001 14.111 14.111 0 01-3.678-6.452.503.503 0 00-.975 0 14.134 14.134 0 01-3.679 6.452 14.155 14.155 0 01-4.45 3.001c-.65.28-1.318.505-2.002.678a.502.502 0 000 .975c.684.172 1.35.397 2.002.677a14.147 14.147 0 014.45 3.001 14.112 14.112 0 013.679 6.453.502.502 0 00.975 0c.172-.685.397-1.351.677-2.003a14.145 14.145 0 013.001-4.45 14.113 14.113 0 016.453-3.678.503.503 0 000-.975 13.245 13.245 0 01-2.003-.678z" fill="url(#lobe-icons-gemini-fill-1)"></path>
          <path d="M20.616 10.835a14.147 14.147 0 01-4.45-3.001 14.111 14.111 0 01-3.678-6.452.503.503 0 00-.975 0 14.134 14.134 0 01-3.679 6.452 14.155 14.155 0 01-4.45 3.001c-.65.28-1.318.505-2.002.678a.502.502 0 000 .975c.684.172 1.35.397 2.002.677a14.147 14.147 0 014.45 3.001 14.112 14.112 0 013.679 6.453.502.502 0 00.975 0c.172-.685.397-1.351.677-2.003a14.145 14.145 0 013.001-4.45 14.113 14.113 0 016.453-3.678.503.503 0 000-.975 13.245 13.245 0 01-2.003-.678z" fill="url(#lobe-icons-gemini-fill-2)"></path>
          <defs>
            <linearGradient gradientUnits="userSpaceOnUse" id="lobe-icons-gemini-fill-0" x1="7" x2="11" y1="15.5" y2="12"><stop stop-color="#08B962"></stop><stop offset="1" stop-color="#08B962" stop-opacity="0"></stop></linearGradient>
            <linearGradient gradientUnits="userSpaceOnUse" id="lobe-icons-gemini-fill-1" x1="8" x2="11.5" y1="5.5" y2="11"><stop stop-color="#F94543"></stop><stop offset="1" stop-color="#F94543" stop-opacity="0"></stop></linearGradient>
            <linearGradient gradientUnits="userSpaceOnUse" id="lobe-icons-gemini-fill-2" x1="3.5" x2="17.5" y1="13.5" y2="12"><stop stop-color="#FABC12"></stop><stop offset=".46" stop-color="#FABC12" stop-opacity="0"></stop></linearGradient>
          </defs>
        </svg>
      </button>
      <!-- 9. Claude -->
      <button class="nav-item" data-tab="claude" title="Claude">
        <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
          <path d="M4.709 15.955l4.72-2.647.08-.23-.08-.128H9.2l-.79-.048-2.698-.073-2.339-.097-2.266-.122-.571-.121L0 11.784l.055-.352.48-.321.686.06 1.52.103 2.278.158 1.652.097 2.449.255h.389l.055-.157-.134-.098-.103-.097-2.358-1.596-2.552-1.688-1.336-.972-.724-.491-.364-.462-.158-1.008.656-.722.881.06.225.061.893.686 1.908 1.476 2.491 1.833.365.304.145-.103.019-.073-.164-.274-1.355-2.446-1.446-2.49-.644-1.032-.17-.619a2.97 2.97 0 01-.104-.729L6.283.134 6.696 0l.996.134.42.364.62 1.414 1.002 2.229 1.555 3.03.456.898.243.832.091.255h.158V9.01l.128-1.706.237-2.095.23-2.695.08-.76.376-.91.747-.492.584.28.48.685-.067.444-.286 1.851-.559 2.903-.364 1.942h.212l.243-.242.985-1.306 1.652-2.064.73-.82.85-.904.547-.431h1.033l.76 1.129-.34 1.166-1.064 1.347-.881 1.142-1.264 1.7-.79 1.36.073.11.188-.02 2.856-.606 1.543-.28 1.841-.315.833.388.091.395-.328.807-1.969.486-2.309.462-3.439.813-.042.03.049.061 1.549.146.662.036h1.622l3.02.225.79.522.474.638-.079.485-1.215.62-1.64-.389-3.829-.91-1.312-.329h-.182v.11l1.093 1.068 2.006 1.81 2.509 2.33.127.578-.322.455-.34-.049-2.205-1.657-.851-.747-1.926-1.62h-.128v.17l.444.649 2.345 3.521.122 1.08-.17.353-.608.213-.668-.122-1.374-1.925-1.415-2.167-1.143-1.943-.14.08-.674 7.254-.316.37-.729.28-.607-.461-.322-.747.322-1.476.389-1.924.315-1.53.286-1.9.17-.632-.012-.042-.14.018-1.434 1.967-2.18 2.945-1.726 1.845-.414.164-.717-.37.067-.662.401-.589 2.388-3.036 1.44-1.882.93-1.086-.006-.158h-.055L4.132 18.56l-1.13.146-.487-.456.061-.746.231-.243 1.908-1.312-.006.006z" fill="#D97757" fill-rule="nonzero"></path>
        </svg>
      </button>
    </nav>

    <div class="sidebar-footer">
      <button class="settings-btn" id="settingsBtn">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="3"></circle>
          <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path>
        </svg>
        <div class="proxy-indicator" id="proxyIndicator"></div>
      </button>
      <div class="brand-icon">K</div>
    </div>
  </aside>

  <!-- 加载提示 -->
  <div class="loading-indicator" id="loadingIndicator">
    <div class="loading-spinner"></div>
    <div class="loading-text" id="loadingText">正在加载...</div>
  </div>

  <!-- 设置面板 -->
  <div class="settings-overlay" id="settingsOverlay">
    <div class="settings-panel">
      <div class="settings-header">
        <div class="settings-title">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="3"></circle>
            <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path>
          </svg>
          设置
        </div>
        <button class="close-btn" id="closeSettings">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </button>
      </div>
      <div class="settings-body">
        <div class="section-title">页面管理</div>
        <div class="tab-toggle-list" id="tabToggleList"></div>

        <div class="section-divider"></div>
        <div class="section-title">代理设置</div>

        <div class="toggle-group">
          <span>启用代理</span>
          <div class="toggle-switch" id="proxyToggle"></div>
        </div>

        <div class="form-group">
          <label class="form-label">代理服务器</label>
          <input type="text" class="form-input" id="proxyServer" placeholder="http://127.0.0.1:7890">
          <div class="form-hint">
            支持格式：<br>
            • HTTP: <code>http://127.0.0.1:7890</code><br>
            • SOCKS5: <code>socks5://127.0.0.1:1080</code><br>
            • SOCKS4: <code>socks4://127.0.0.1:1080</code><br>
            仅 ChatGPT、Gemini、Claude 使用代理
          </div>
        </div>

        <div class="test-result" id="testResult"></div>

        <div class="btn-group">
          <button class="btn btn-secondary" id="testProxyBtn">测试连接</button>
          <button class="btn btn-primary" id="saveProxyBtn">保存设置</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const navItems = document.querySelectorAll('.nav-item');
      const settingsBtn = document.getElementById('settingsBtn');
      const settingsOverlay = document.getElementById('settingsOverlay');
      const closeSettings = document.getElementById('closeSettings');
      const proxyToggle = document.getElementById('proxyToggle');
      const proxyServer = document.getElementById('proxyServer');
      const testProxyBtn = document.getElementById('testProxyBtn');
      const saveProxyBtn = document.getElementById('saveProxyBtn');
      const testResult = document.getElementById('testResult');
      const proxyIndicator = document.getElementById('proxyIndicator');
      const loadingIndicator = document.getElementById('loadingIndicator');
      const loadingText = document.getElementById('loadingText');

      let currentTab = 'yuanbao';
      let enabledTabs = [];
      let allTabsConfig = [];

      // 标签名称：从主进程配置动态加载，消除与 main.js 中 AI_TABS 的硬编码重复
      // 加载前使用 HTML nav-item 的 title 属性作为备用
      let tabNames = {};

      function getTabName(tabId) {
        if (tabNames[tabId]) return tabNames[tabId];
        const btn = document.querySelector(`.nav-item[data-tab="${tabId}"]`);
        return btn ? btn.title : tabId;
      }

      const tabColors = {
        yuanbao: '#00d4aa',
        yiyan: '#4f8cff',
        doubao: '#4facfe',
        deepseek: '#4d6bfe',
        kimi: '#027AFF',
        qwen: '#6F69F7',
        chatgpt: '#10a37f',
        gemini: '#4d8cf6',
        claude: '#d97757'
      };

      // 页面管理：加载标签配置
      async function loadTabConfig() {
        if (!window.electronAPI || !window.electronAPI.getTabConfig) return;
        try {
          const config = await window.electronAPI.getTabConfig();
          allTabsConfig = config.allTabs;
          enabledTabs = config.enabledTabs;
          // 从配置同步标签名称，保持与主进程 AI_TABS 一致
          allTabsConfig.forEach(tab => { tabNames[tab.id] = tab.name; });
          updateNavVisibility();
          generateTabToggles();
        } catch (e) {
          // 如果加载失败，默认全部显示
        }
      }

      // 更新侧边栏标签可见性
      function updateNavVisibility() {
        if (enabledTabs.length === 0) return;
        navItems.forEach(item => {
          const tabId = item.dataset.tab;
          item.style.display = enabledTabs.includes(tabId) ? '' : 'none';
        });
        // 如果当前活跃标签被禁用，切换到第一个启用的标签
        if (!enabledTabs.includes(currentTab)) {
          const allTabIds = allTabsConfig.map(t => t.id);
          const firstEnabled = allTabIds.find(id => enabledTabs.includes(id));
          if (firstEnabled) {
            const btn = document.querySelector(`.nav-item[data-tab="${firstEnabled}"]`);
            if (btn) btn.click();
          }
        }
      }

      // 生成设置面板中的标签开关列表
      function generateTabToggles() {
        const container = document.getElementById('tabToggleList');
        container.innerHTML = '';

        allTabsConfig.forEach(tab => {
          const isEnabled = enabledTabs.includes(tab.id);
          const item = document.createElement('div');
          item.className = 'tab-toggle-item';
          item.innerHTML = `
            <span class="tab-toggle-name">
              <span class="tab-toggle-dot" style="background: ${tabColors[tab.id] || '#888'}"></span>
              ${tab.name}
            </span>
            <div class="toggle-switch-sm ${isEnabled ? 'active' : ''}" data-tab-id="${tab.id}"></div>
          `;

          const toggle = item.querySelector('.toggle-switch-sm');
          toggle.addEventListener('click', () => {
            const tabId = toggle.dataset.tabId;
            const willEnable = !toggle.classList.contains('active');

            // 至少保留一个启用的页面
            if (!willEnable && enabledTabs.length <= 1) return;

            if (willEnable) {
              // 按 allTabsConfig 原始顺序插入，保持一致
              const allIds = allTabsConfig.map(t => t.id);
              enabledTabs.push(tabId);
              enabledTabs.sort((a, b) => allIds.indexOf(a) - allIds.indexOf(b));
            } else {
              enabledTabs = enabledTabs.filter(id => id !== tabId);
            }

            toggle.classList.toggle('active');
            updateToggleDisabledState();
            updateNavVisibility();

            // 立即保存配置
            if (window.electronAPI) {
              window.electronAPI.setEnabledTabs(enabledTabs);
            }
          });

          container.appendChild(item);
        });

        updateToggleDisabledState();
      }

      // 当只剩一个启用的标签时，禁用该标签的开关
      function updateToggleDisabledState() {
        const toggles = document.querySelectorAll('.toggle-switch-sm[data-tab-id]');
        toggles.forEach(toggle => {
          const isLastEnabled = enabledTabs.length <= 1 && toggle.classList.contains('active');
          toggle.classList.toggle('disabled', isLastEnabled);
        });
      }

      // 初始加载标签配置
      loadTabConfig();

      // 监听加载状态
      if (window.electronAPI && window.electronAPI.onLoadingStatus) {
        window.electronAPI.onLoadingStatus((data) => {
          if (data.tab === currentTab) {
            if (data.loading) {
              loadingText.textContent = `正在加载 ${getTabName(data.tab)}...`;
              loadingIndicator.classList.add('show');
            } else {
              loadingIndicator.classList.remove('show');
              if (data.error) {
                loadingText.textContent = `加载失败: ${data.error}`;
                loadingIndicator.classList.add('show');
                // 延长错误显示时间，方便用户查看具体错误
                setTimeout(() => loadingIndicator.classList.remove('show'), 5000);
              }
            }
          }
        });
      }

      // 加载代理配置
      if (window.electronAPI) {
        window.electronAPI.getProxyConfig().then(config => {
          proxyToggle.classList.toggle('active', config.enabled);
          proxyServer.value = config.server || '';
          proxyIndicator.classList.toggle('active', config.enabled);
        }).catch(console.error);
      }

      // 切换标签
      navItems.forEach(item => {
        item.addEventListener('click', () => {
          navItems.forEach(nav => nav.classList.remove('active'));
          item.classList.add('active');

          currentTab = item.dataset.tab;
          loadingText.textContent = `正在加载 ${getTabName(currentTab)}...`;
          loadingIndicator.classList.add('show');

          if (window.electronAPI) {
            window.electronAPI.switchTab(currentTab);
          }
        });
      });

      // 设置面板
      function openSettings() {
        settingsOverlay.classList.add('active');
        if (window.electronAPI) window.electronAPI.showViews(false);
      }

      function closeSettingsPanel() {
        settingsOverlay.classList.remove('active');
        if (window.electronAPI) window.electronAPI.showViews(true);
      }

      settingsBtn.addEventListener('click', openSettings);
      closeSettings.addEventListener('click', closeSettingsPanel);
      settingsOverlay.addEventListener('click', (e) => {
        if (e.target === settingsOverlay) closeSettingsPanel();
      });

      proxyToggle.addEventListener('click', () => proxyToggle.classList.toggle('active'));

      let resultTimeout = null;  // 用于跟踪 showResult 的 timeout

      // 测试代理
      testProxyBtn.addEventListener('click', async () => {
        if (!window.electronAPI) return;
        const config = {
          enabled: proxyToggle.classList.contains('active'),
          server: proxyServer.value.trim()
        };
        if (!config.server) {
          showResult(false, '请输入代理地址');
          return;
        }
        // 禁用按钮防止重复点击
        testProxyBtn.disabled = true;
        testProxyBtn.textContent = '测试中...';
        try {
          const result = await window.electronAPI.testProxy(config);
          showResult(result.success, result.message);
        } catch (err) {
          showResult(false, '测试失败: ' + err.message);
        } finally {
          testProxyBtn.disabled = false;
          testProxyBtn.textContent = '测试连接';
        }
      });

      // 保存代理
      saveProxyBtn.addEventListener('click', async () => {
        if (!window.electronAPI) return;
        const config = {
          enabled: proxyToggle.classList.contains('active'),
          server: proxyServer.value.trim()
        };
        // 禁用按钮防止重复点击
        saveProxyBtn.disabled = true;
        try {
          await window.electronAPI.setProxyConfig(config);
          proxyIndicator.classList.toggle('active', config.enabled);
          showResult(true, '已保存');
        } catch (err) {
          showResult(false, '保存失败: ' + err.message);
        } finally {
          saveProxyBtn.disabled = false;
        }
      });

      function showResult(success, msg) {
        // 清除之前的 timeout，避免累积
        if (resultTimeout) {
          clearTimeout(resultTimeout);
        }
        testResult.className = 'test-result show ' + (success ? 'success' : 'error');
        testResult.textContent = msg;
        // 3秒后自动隐藏结果
        resultTimeout = setTimeout(() => {
          testResult.classList.remove('show');
          resultTimeout = null;
        }, 3000);
      }

      // Escape 关闭设置面板
      document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape' && settingsOverlay.classList.contains('active')) {
          closeSettingsPanel();
        }
      });
    });
  </script>
</body>
</html>
